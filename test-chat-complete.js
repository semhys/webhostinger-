// Test completo del sistema de chat SEMHYS
const testChatSystem = async () => {
  const baseUrl = 'http://localhost:3000';
  
  console.log('üöÄ INICIANDO PRUEBA COMPLETA DEL CHAT SEMHYS\n');

  // Casos de prueba diversos
  const testCases = [
    {
      name: 'CONSULTA T√âCNICA - Bomba Centr√≠fuga',
      message: 'Necesito especificaciones t√©cnicas para una bomba centr√≠fuga de 500 HP para aplicaci√≥n industrial',
      expectedCategory: 'technical'
    },
    {
      name: 'CONSULTA T√âCNICA - Automatizaci√≥n',
      message: 'Requiero informaci√≥n sobre sistemas de automatizaci√≥n y control PLC para l√≠nea de producci√≥n',
      expectedCategory: 'technical'
    },
    {
      name: 'CONSULTA GENERAL - Servicios',
      message: 'Hola, quisiera conocer m√°s sobre los servicios que ofrece SEMHYS',
      expectedCategory: 'general'
    },
    {
      name: 'CONSULTA GENERAL - Contacto',
      message: 'Me gustar√≠a obtener una cotizaci√≥n para un proyecto de ingenier√≠a',
      expectedCategory: 'general'
    },
    {
      name: 'CONSULTA URGENTE - Falla',
      message: 'URGENTE: Tenemos una falla cr√≠tica en el motor principal de la planta',
      expectedCategory: 'technical'
    }
  ];

  let passedTests = 0;
  let totalTests = testCases.length;

  for (let i = 0; i < testCases.length; i++) {
    const testCase = testCases[i];
    console.log(`üìã Test ${i + 1}/${totalTests}: ${testCase.name}`);
    console.log(`   Mensaje: "${testCase.message}"`);

    try {
      const response = await fetch(`${baseUrl}/api/chat`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          message: testCase.message,
          language: 'es',
          timestamp: new Date().toISOString(),
          sessionId: `test-session-${i + 1}`
        })
      });

      if (response.ok) {
        const result = await response.json();
        
        console.log(`   ‚úÖ Status: ${response.status}`);
        console.log(`   üéØ Categor√≠a detectada: ${result.category}`);
        console.log(`   ‚ö° Prioridad: ${result.priority}`);
        console.log(`   üí¨ Respuesta: "${result.response.substring(0, 80)}..."`);
        
        // Verificar clasificaci√≥n
        if (result.category === testCase.expectedCategory) {
          console.log(`   ‚úÖ Clasificaci√≥n CORRECTA`);
          passedTests++;
        } else {
          console.log(`   ‚ùå Clasificaci√≥n INCORRECTA (esperado: ${testCase.expectedCategory})`);
        }
        
      } else {
        console.log(`   ‚ùå Error HTTP: ${response.status}`);
        const errorText = await response.text();
        console.log(`   Error: ${errorText}`);
      }

    } catch (error) {
      console.log(`   ‚ùå Error de conexi√≥n: ${error.message}`);
    }

    console.log(''); // L√≠nea en blanco
    
    // Pausa entre tests
    if (i < testCases.length - 1) {
      await new Promise(resolve => setTimeout(resolve, 1000));
    }
  }

  // Resumen final
  console.log('üéØ RESUMEN DE PRUEBAS:');
  console.log(`   Tests pasados: ${passedTests}/${totalTests}`);
  console.log(`   Porcentaje de √©xito: ${((passedTests/totalTests) * 100).toFixed(1)}%`);
  
  if (passedTests === totalTests) {
    console.log('   üéâ ¬°TODOS LOS TESTS PASARON! El chat est√° funcionando correctamente.');
  } else {
    console.log('   ‚ö†Ô∏è  Algunos tests fallaron. Revisar la l√≥gica de clasificaci√≥n.');
  }

  console.log('\nüîó Pr√≥ximo paso: Importar workflow en n8n.cloud para activar el webhook');
};

// Ejecutar las pruebas
testChatSystem().catch(console.error);