{
  "name": "SEMHYS Chat Agent - Clasificador Inteligente",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "semhys-chat",
        "options": {}
      },
      "id": "webhook-chat",
      "name": "Chat Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300],
      "webhookId": "semhys-chat-webhook"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.category}}",
              "operation": "equal",
              "value2": "technical"
            }
          ]
        }
      },
      "id": "clasificador",
      "name": "Clasificador Consultas",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [460, 300]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "response_type",
              "value": "technical_consultation"
            },
            {
              "name": "department",
              "value": "engineering"
            },
            {
              "name": "escalation_level", 
              "value": "={{$json.priority === 'high' ? 'urgent' : 'standard'}}"
            },
            {
              "name": "expertise_required",
              "value": "={{$json.message.toLowerCase().includes('bomba') ? 'hydraulic_systems' : $json.message.toLowerCase().includes('motor') ? 'electrical_systems' : $json.message.toLowerCase().includes('automatizaci√≥n') ? 'automation_control' : 'general_engineering'}}"
            },
            {
              "name": "response_message",
              "value": "Consulta t√©cnica especializada recibida. Nuestro equipo de ingenier√≠a {{$json.expertise_required}} revisar√° su solicitud y le proporcionar√° una respuesta detallada en las pr√≥ximas 2-4 horas. Su n√∫mero de ticket es: #TECH-{{$json.sessionId}}"
            }
          ]
        },
        "options": {}
      },
      "id": "technical-processing",
      "name": "Procesamiento T√©cnico",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [680, 200]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "response_type",
              "value": "general_consultation"
            },
            {
              "name": "department", 
              "value": "customer_service"
            },
            {
              "name": "response_message",
              "value": "{{$json.message.toLowerCase().includes('precio') || $json.message.toLowerCase().includes('cotizaci√≥n') ? 'Gracias por su inter√©s en SEMHYS. Un especialista en ventas se comunicar√° con usted en las pr√≥ximas 24 horas para proporcionarle una cotizaci√≥n personalizada.' : $json.message.toLowerCase().includes('servicio') ? 'SEMHYS ofrece soluciones integrales de ingenier√≠a industrial, automatizaci√≥n y consultor√≠a t√©cnica. ¬øEn qu√© √°rea espec√≠fica podemos asistirle?' : 'Gracias por contactar a SEMHYS. Hemos recibido su consulta y le responderemos a la brevedad. Para consultas urgentes, puede llamar al +57 300 123 4567.'}}"
            }
          ]
        },
        "options": {}
      },
      "id": "general-processing",
      "name": "Procesamiento General",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [680, 400]
    },
    {
      "parameters": {
        "authentication": "generic",
        "genericAuthType": "httpBasicAuth",
        "url": "smtp.hostinger.com",
        "sendTo": "engineering@semhys.com, contact@semhys.com",
        "subject": "üîß CONSULTA T√âCNICA URGENTE - SEMHYS Chat",
        "message": "=NUEVA CONSULTA T√âCNICA RECIBIDA\n\nüìã DETALLES:\n‚Ä¢ Mensaje: {{$json.message}}\n‚Ä¢ Categor√≠a: {{$json.category}}\n‚Ä¢ Prioridad: {{$json.priority}}\n‚Ä¢ Confianza: {{$json.confidence}}\n‚Ä¢ Especialidad: {{$json.expertise_required}}\n‚Ä¢ Idioma: {{$json.language}}\n‚Ä¢ Sesi√≥n: {{$json.sessionId}}\n‚Ä¢ Timestamp: {{$json.timestamp}}\n\n‚ö° ACCI√ìN REQUERIDA:\nEsta consulta requiere atenci√≥n del equipo de {{$json.expertise_required}}.\n\nüéØ RESPUESTA SUGERIDA:\n{{$json.response_message}}\n\n---\nSEMHYS AI Agent v2.0",
        "options": {
          "ccEmail": "",
          "bccEmail": "",
          "appendAttribution": false
        }
      },
      "id": "email-technical",
      "name": "Email T√©cnico",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [900, 200],
      "credentials": {
        "smtp": {
          "id": "semhys-smtp",
          "name": "SEMHYS SMTP"
        }
      }
    },
    {
      "parameters": {
        "authentication": "generic", 
        "genericAuthType": "httpBasicAuth",
        "url": "smtp.hostinger.com",
        "sendTo": "contact@semhys.com",
        "subject": "üí¨ Nueva Consulta General - SEMHYS Chat",
        "message": "=NUEVA CONSULTA GENERAL RECIBIDA\n\nüìã DETALLES:\n‚Ä¢ Mensaje: {{$json.message}}\n‚Ä¢ Tipo: {{$json.response_type}}\n‚Ä¢ Prioridad: {{$json.priority}}\n‚Ä¢ Idioma: {{$json.language}}\n‚Ä¢ Sesi√≥n: {{$json.sessionId}}\n‚Ä¢ Timestamp: {{$json.timestamp}}\n\nüí¨ RESPUESTA ENVIADA:\n{{$json.response_message}}\n\n---\nSEMHYS AI Agent v2.0",
        "options": {
          "ccEmail": "",
          "bccEmail": "",
          "appendAttribution": false
        }
      },
      "id": "email-general",
      "name": "Email General",
      "type": "n8n-nodes-base.emailSend", 
      "typeVersion": 2,
      "position": [900, 400],
      "credentials": {
        "smtp": {
          "id": "semhys-smtp",
          "name": "SEMHYS SMTP"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\"success\": true, \"customResponse\": \"{{$json.response_message}}\", \"category\": \"{{$json.category}}\", \"department\": \"{{$json.department}}\", \"ticket\": \"#TECH-{{$json.sessionId}}\"}",
        "options": {}
      },
      "id": "response-technical",
      "name": "Respuesta T√©cnica",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1120, 200]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\"success\": true, \"customResponse\": \"{{$json.response_message}}\", \"category\": \"{{$json.category}}\", \"department\": \"{{$json.department}}\"}",
        "options": {}
      },
      "id": "response-general",
      "name": "Respuesta General", 
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1120, 400]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "log_entry",
              "value": "={{$now.toISO()}} - [{{$json.category.toUpperCase()}}] {{$json.message.substring(0,50)}}... | Session: {{$json.sessionId}} | Priority: {{$json.priority}}"
            }
          ]
        },
        "options": {}
      },
      "id": "analytics-logger",
      "name": "Analytics Logger",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [460, 500]
    }
  ],
  "connections": {
    "Chat Webhook": {
      "main": [
        [
          {
            "node": "Clasificador Consultas",
            "type": "main",
            "index": 0
          },
          {
            "node": "Analytics Logger",
            "type": "main", 
            "index": 0
          }
        ]
      ]
    },
    "Clasificador Consultas": {
      "main": [
        [
          {
            "node": "Procesamiento T√©cnico",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Procesamiento General", 
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Procesamiento T√©cnico": {
      "main": [
        [
          {
            "node": "Email T√©cnico",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Procesamiento General": {
      "main": [
        [
          {
            "node": "Email General",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Email T√©cnico": {
      "main": [
        [
          {
            "node": "Respuesta T√©cnica",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Email General": {
      "main": [
        [
          {
            "node": "Respuesta General",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "timezone": "America/Bogota"
  },
  "versionId": "1.0"
}